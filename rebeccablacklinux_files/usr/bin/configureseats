#! /bin/bash
#    Copyright (c) 2012, nerdopolis (or n3rdopolis) <bluescreen_avenger@version.net>
#
#    This file is part of RebeccaBlackLinux.
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.

NumberOfDevices=0
while read Device
do
DeviceProperties=$(udevadm info --query=property  --name=$Device)
DeviceDisplayName=$(udevadm info -q all --attribute-walk --name=$Device | sed -e '/looking at/d' -e 's/    //g' -e 's/==/=/g' -e 's/"//g' | awk -F ' *= *' '$1 == "ATTRS{name}" {print $0}' | cut -d = -f2- | tail -1 )
DeviceName=$(echo "$DeviceProperties" | awk -F ' *= *' '$1 == "ID_PATH" {print $0}' | cut -d = -f2- | tail -1 )
DeviceConnection=$(echo "$DeviceProperties" | awk -F ' *= *' '$1 == "ID_PATH" {print $0}' | cut -d = -f2- | tail -1 )
DeviceSeatID=$(echo "$DeviceProperties" | awk -F ' *= *' '$1 == "ID_SEAT" {print $0}' | cut -d = -f2- | tail -1 )
IsDeviceMouse=$(echo "$DeviceProperties" | awk -F ' *= *' '$1 == "ID_INPUT_MOUSE" {print $0}' | cut -d = -f2- | tail -1 )
IsDeviceTouchscreen=$(echo "$DeviceProperties" | awk -F ' *= *' '$1 == "ID_INPUT_TOUCHSCREEN" {print $0}' | cut -d = -f2- | tail -1 )
IsDeviceTouchpad=$(echo "$DeviceProperties" | awk -F ' *= *' '$1 == "ID_INPUT_TOUCHPAD" {print $0}' | cut -d = -f2- | tail -1 )
IsDeviceKeyboard=$(echo "$DeviceProperties" | awk -F ' *= *' '$1 == "ID_INPUT_KEYBOARD" {print $0}' | cut -d = -f2- | tail -1 )

if [[ -z $DeviceDisplayName ]]
then
DeviceDisplayName=$DeviceName
  if [[ $DeviceDisplayName == "noserial" ]]
  then
  DeviceDisplayName="Generic"
  fi
fi

unset DeviceType
if [[ -z $IsDeviceMouse ]]
then
IsDeviceMouse=0
else
DeviceType+=M
fi
if [[ -z $IsDeviceTouchscreen ]]
then
IsDeviceTouchscreen=0
else
DeviceType+=S
fi
if [[ -z $IsDeviceTouchpad ]]
then
IsDeviceTouchpad=0
else
DeviceType+=T
fi
if [[ -z $IsDeviceKeyboard ]]
then
IsDeviceKeyboard=0
else
DeviceType+=K
fi

if [[ ! -z $DeviceType ]]
then
((NumberOfDevices++))
DeviceDisplayNames[$NumberOfDevices]=$DeviceDisplayName
DeviceNames[$NumberOfDevices]=$DeviceName
DeviceConnections[$NumberOfDevices]=$DeviceConnection
DeviceSeatIDs[$NumberOfDevices]=$DeviceSeatID
DeviceTypes[$NumberOfDevices]=$DeviceType
fi

done < <(find /dev/input/event*)