#! /bin/bash
#    Copyright (c) 2012, 2013, 2014, 2015, 2016 nerdopolis (or n3rdopolis) <bluescreen_avenger@verzion.net>
#
#    This file is part of RebeccaBlackOS.
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.

#This script calls all files in /usr/bin/Compile in the needed order. it also fowards if it was called with build-only or download-only to the scripts.
#It also configures build_core (which is used by all of the build scripts) to create debs as they build, by turning on the MAKEDEBS argument.

argument=$1

export MAKEDEBS=1

#Add the package name to COMPILELIST, ensuring the correct handling of newlines
function AddPackageToList
{
  PACKAGENAME=$1
  if [[ -z $COMPILELIST ]]
  then
    COMPILELIST+=$PACKAGENAME
  else 
    COMPILELIST+=$'\n'$PACKAGENAME
  fi
}

#build these packages in this order. # symbol is a comment
if [[ ! -e /usr/lib/casper ]]
then
  AddPackageToList casper
fi

if [[ ! -e /usr/share/initramfs-tools/hooks/lupin_casper ]]
then
  AddPackageToList lupin
fi

#AddPackageToList linux
AddPackageToList cmake
AddPackageToList extra-cmake-modules
AddPackageToList wayland
AddPackageToList wayland-protocols
AddPackageToList drm
AddPackageToList macros
AddPackageToList glproto
AddPackageToList dri2proto
AddPackageToList dri3proto
AddPackageToList libxtrans
AddPackageToList xextproto
AddPackageToList presentproto
AddPackageToList x11proto
AddPackageToList fontsproto
AddPackageToList randrproto
AddPackageToList xshmfence
AddPackageToList xcb-proto
AddPackageToList libxcb
AddPackageToList libxfont
AddPackageToList mesa
AddPackageToList glamor
AddPackageToList libepoxy
AddPackageToList libxkbcommon
AddPackageToList libevdev
AddPackageToList pixman
AddPackageToList cairo
AddPackageToList libva
AddPackageToList intel-driver
AddPackageToList libinput
AddPackageToList freerdp
AddPackageToList weston
AddPackageToList glib
AddPackageToList harfbuzz
AddPackageToList freetype2
AddPackageToList fontconfig
AddPackageToList pango
AddPackageToList gstreamer
AddPackageToList gst-plugins-base
AddPackageToList gst-plugins-bad
AddPackageToList gst-plugins-good
AddPackageToList gst-plugins-ugly
AddPackageToList gst-plugins-gl
AddPackageToList gst-libav
AddPackageToList qtbase
AddPackageToList qtxmlpatterns
AddPackageToList qtdeclarative
AddPackageToList qtmultimedia
AddPackageToList qtsvg
AddPackageToList qtsensors
AddPackageToList qtimageformats
AddPackageToList qtsystems
AddPackageToList qt3d
AddPackageToList qtwebkit
AddPackageToList qtwebsockets
AddPackageToList qtwebchannel
AddPackageToList qtwebengine
AddPackageToList qtscript
AddPackageToList qtquick1
AddPackageToList qtquickcontrols
AddPackageToList qtquickcontrols2
AddPackageToList qttools
AddPackageToList qtx11extras
AddPackageToList qttranslations
AddPackageToList qtgraphicaleffects
AddPackageToList qtwayland
AddPackageToList qca
AddPackageToList otter
AddPackageToList libdbusmenu-qt
AddPackageToList phonon
AddPackageToList phonon-gstreamer
AddPackageToList attica
AddPackageToList polkit-qt-1
AddPackageToList kwayland
AddPackageToList kdeframeworks/kitemmodels
AddPackageToList kdeframeworks/kitemviews
AddPackageToList kdeframeworks/kplotting
AddPackageToList kdeframeworks/threadweaver
AddPackageToList kdeframeworks/kcodecs
AddPackageToList kdeframeworks/kguiaddons
AddPackageToList kdeframeworks/kidletime
AddPackageToList kdeframeworks/kwidgetsaddons
AddPackageToList kdeframeworks/sonnet
AddPackageToList kdeframeworks/kconfig
AddPackageToList kdeframeworks/kwindowsystem
AddPackageToList kdeframeworks/networkmanager-qt
AddPackageToList kdeframeworks/modemmanager-qt
AddPackageToList kdeframeworks/bluez-qt
AddPackageToList kdeframeworks/solid
AddPackageToList kdeframeworks/karchive
AddPackageToList kdeframeworks/syntax-highlighting
AddPackageToList kdeframeworks/kdbusaddons
AddPackageToList kdeframeworks/kcoreaddons
AddPackageToList kdeframeworks/kimageformats
AddPackageToList kdeframeworks/kauth
AddPackageToList kdeframeworks/kcrash
AddPackageToList kdeframeworks/kjobwidgets
AddPackageToList kdeframeworks/ki18n
AddPackageToList kdeframeworks/kdoctools
AddPackageToList kdeframeworks/kjs
AddPackageToList kdeframeworks/kservice
AddPackageToList kdeframeworks/kglobalaccel
AddPackageToList kdeframeworks/kpackage
AddPackageToList kdeframeworks/kpeople
AddPackageToList kdeframeworks/kconfigwidgets
AddPackageToList kdeframeworks/kiconthemes
AddPackageToList kdeframeworks/knotifications
AddPackageToList kdeframeworks/kcompletion
AddPackageToList kdeframeworks/kdnssd
AddPackageToList kdeframeworks/kwallet
AddPackageToList kdeframeworks/kpty
AddPackageToList kdeframeworks/kemoticons
AddPackageToList kdeframeworks/kdesu
AddPackageToList kdeframeworks/ktextwidgets
AddPackageToList kdeframeworks/kxmlgui
AddPackageToList kdeframeworks/kbookmarks
AddPackageToList kdeframeworks/kio
AddPackageToList kdeframeworks/kxmlrpcclient
AddPackageToList kdeframeworks/kdesignerplugin
AddPackageToList kdeframeworks/knewstuff
AddPackageToList kdeframeworks/kparts
AddPackageToList kdeframeworks/kdeclarative
AddPackageToList kdeframeworks/kcmutils
AddPackageToList kdeframeworks/kinit
AddPackageToList kdeframeworks/kded
AddPackageToList kdeframeworks/knotifyconfig
AddPackageToList kdeframeworks/kunitconversion
AddPackageToList kdeframeworks/kjsembed
AddPackageToList kdeframeworks/kross
AddPackageToList kdeframeworks/kmediaplayer
AddPackageToList kdeframeworks/kdewebkit
AddPackageToList kdeframeworks/ktexteditor
AddPackageToList kdeframeworks/kapidox
AddPackageToList kdeframeworks/frameworkintegration
AddPackageToList kdeframeworks/kdelibs4support
AddPackageToList kdeframeworks/khtml
AddPackageToList kwayland-integration
AddPackageToList kwallet-pam
AddPackageToList kwalletmanager
AddPackageToList libkomparediff2
AddPackageToList grantlee
AddPackageToList kdevplatform
AddPackageToList kfilemetadata
AddPackageToList baloo
AddPackageToList baloo-widgets
AddPackageToList kactivities
AddPackageToList kactivities-stats
AddPackageToList kpmcore
AddPackageToList plasma-framework
AddPackageToList kirigami
AddPackageToList krunner
AddPackageToList milou
AddPackageToList khelpcenter
AddPackageToList kde-cli-tools
AddPackageToList kio-extras
AddPackageToList konqueror
AddPackageToList kfind
AddPackageToList kdialog
AddPackageToList keditbookmarks
AddPackageToList dolphin
AddPackageToList libksysguard
AddPackageToList ksysguard
AddPackageToList kdecoration
AddPackageToList kscreenlocker
AddPackageToList oxygen
AddPackageToList breeze
AddPackageToList plasma-integration
AddPackageToList kwin
AddPackageToList libkscreen
AddPackageToList plasma-workspace
AddPackageToList plasma-desktop
AddPackageToList kactivitymanagerd
AddPackageToList khotkeys
AddPackageToList kinfocenter
AddPackageToList kmenuedit
AddPackageToList systemsettings
AddPackageToList kscreen
AddPackageToList powerdevil
AddPackageToList polkit-kde-agent-1
AddPackageToList rekonq
AddPackageToList kmix
AddPackageToList konsole
AddPackageToList kate
AddPackageToList ark
AddPackageToList konversation
AddPackageToList kcalc
AddPackageToList kompare
AddPackageToList dragon
AddPackageToList plasma-sdk
AddPackageToList kdeplasma-addons
AddPackageToList plasma-nm
AddPackageToList plasma-pa
AddPackageToList calligra
AddPackageToList wind
AddPackageToList hawaii-icon-themes
AddPackageToList qtaccountsservice
AddPackageToList libqtxdg
AddPackageToList greenisland
AddPackageToList libhawaii
AddPackageToList fluid
AddPackageToList hawaii-shell
AddPackageToList hawaii-workspace
AddPackageToList hawaii-system-preferences
AddPackageToList xserver
AddPackageToList xhost
AddPackageToList json-glib
AddPackageToList gdk-pixbuf
AddPackageToList librsvg
AddPackageToList yelp-xsl
AddPackageToList yelp-tools
AddPackageToList atk
AddPackageToList at-spi2-core
AddPackageToList at-spi2-atk
AddPackageToList graphene
AddPackageToList gtk
AddPackageToList zenity
AddPackageToList gnome-themes-standard
AddPackageToList dconf
AddPackageToList unico
AddPackageToList vte
AddPackageToList cogl
AddPackageToList clutter
AddPackageToList clutter-gtk
AddPackageToList clutter-gst
AddPackageToList gobject-introspection
AddPackageToList gjs
AddPackageToList libusb
AddPackageToList gsettings-desktop-schemas
AddPackageToList libnotify
AddPackageToList glib-networking
AddPackageToList libsoup
AddPackageToList gcr
AddPackageToList geoclue
AddPackageToList webkitgtk
AddPackageToList librest
AddPackageToList gnome-online-accounts
AddPackageToList geocode-glib
AddPackageToList libgweather
AddPackageToList libgdata
AddPackageToList evolution-data-server
AddPackageToList libpeas
AddPackageToList gtksourceview
AddPackageToList libsecret
AddPackageToList libgtop
AddPackageToList gnome-desktop
AddPackageToList libcanberra
AddPackageToList notification-daemon
AddPackageToList gnome-bluetooth
AddPackageToList gnome-menus
AddPackageToList libgnome-keyring
AddPackageToList network-manager-applet
AddPackageToList mutter
AddPackageToList colord-gtk
AddPackageToList gnome-shell
AddPackageToList gnome-shell-extensions
AddPackageToList gnome-settings-daemon
AddPackageToList gnome-autoar
AddPackageToList pygobject
AddPackageToList libgee
AddPackageToList caribou
AddPackageToList gnome-session
AddPackageToList gdm
AddPackageToList ibus
AddPackageToList seahorse
AddPackageToList alacarte
AddPackageToList nautilus
AddPackageToList gspell
AddPackageToList gedit
AddPackageToList file-roller
AddPackageToList gnome-font-viewer
AddPackageToList grilo
AddPackageToList grilo-plugins
AddPackageToList gnome-control-center
AddPackageToList cairo-dock-core
AddPackageToList cairo-dock-plugins
AddPackageToList orbital
AddPackageToList efl
AddPackageToList enlightenment
AddPackageToList terminology
AddPackageToList etrophy
AddPackageToList e_cho
AddPackageToList elemines
AddPackageToList econcentration
AddPackageToList equate
AddPackageToList ecrire
AddPackageToList ephoto
AddPackageToList SDL
AddPackageToList SDL_image
AddPackageToList SDL_ttf
AddPackageToList glbinding
AddPackageToList supertux
AddPackageToList FreeGLUT
AddPackageToList glfw
AddPackageToList ffmpeg
AddPackageToList mpv
AddPackageToList glmark
AddPackageToList bemenu
AddPackageToList wlc
AddPackageToList orbment
AddPackageToList sway

if [[ ! -e /usr/bin/ubiquity ]]
then
  AddPackageToList calamares
fi

echo "$COMPILELIST" | while read BUILDNAME
do

  #compile_all is running to download the source
  if [[ "$argument" == download-only ]]
  then
    echo "Downloading/updating $BUILDNAME source"
    "/usr/bin/Compile/$BUILDNAME" download-only 2>&1 
  fi

  #compile_all is running to build the source
  if [[ "$argument" == build-only ]]
  then
    echo "building $BUILDNAME"
    "/usr/bin/Compile/$BUILDNAME" build-only 2>&1
  fi

  #Install the smaller version of the package
  if [[ "$argument" == installsmallpackage ]]
  then
    echo "Attempting to install smaller version of $BUILDNAME"
    "/usr/bin/Compile/$BUILDNAME" installsmallpackage 2>&1
  fi
  
  #compile_all is running to clean the source
  if [[ "$argument" == clean ]]
  then
    echo "Cleaning $BUILDNAME"
    "/usr/bin/Compile/$BUILDNAME" clean 2>&1
  fi
  
  #compile_all is running to download and build
  if [[ ! -n "$argument" ]]
  then
    "/usr/bin/Compile/$BUILDNAME"
  fi

done
