#! /bin/bash
#    Copyright (c) 2012, 2013, 2014, 2015, 2016 nerdopolis (or n3rdopolis) <bluescreen_avenger@verzion.net>
#
#    This file is part of RebeccaBlackOS.
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.

#This script calls all files in /usr/bin/Compile in the needed order. it also fowards if it was called with build-only or download-only to the scripts.
#It also configures build_core (which is used by all of the build scripts) to create debs as they build, by turning on the MAKEDEBS argument.

argument=$1

export MAKEDEBS=1


#build these packages in this order. # symbol is a comment
if [[ ! -e /usr/lib/casper ]]
then
  COMPILELIST+="casper"
  COMPILELIST+=$'\n'
fi

if [[ ! -e /usr/share/initramfs-tools/hooks/lupin_casper ]]
then
  COMPILELIST+="lupin"
  COMPILELIST+=$'\n'
fi

COMPILELIST+="#linux
wayland
wayland-protocols
drm
macros
glproto
dri2proto
dri3proto
libxtrans
xextproto
presentproto
x11proto
fontsproto
randrproto
xshmfence
xcb-proto
libxcb
libxfont
mesa
glamor
libepoxy
libxkbcommon
libevdev
pixman
cairo
libva
intel-driver
libinput
freerdp
weston
cmake
extra-cmake-modules
qtbase
qtxmlpatterns
qtdeclarative
qtmultimedia
qtsvg
qtsensors
qtimageformats
qtsystems
qt3d
qtwebkit
qtwebsockets
qtwebchannel
#qtwebengine
qtscript
qtquick1
qtquickcontrols
qtquickcontrols2
qttools
qtx11extras
qttranslations
qtgraphicaleffects
qtwayland
qca
otter
libdbusmenu-qt
phonon
phonon-gstreamer
attica
polkit-qt-1
kwayland
kdeframeworks/kitemmodels
kdeframeworks/kitemviews
kdeframeworks/kplotting
kdeframeworks/threadweaver
kdeframeworks/kcodecs
kdeframeworks/kguiaddons
kdeframeworks/kidletime
kdeframeworks/kwidgetsaddons
kdeframeworks/sonnet
kdeframeworks/kconfig
kdeframeworks/kwindowsystem
kdeframeworks/networkmanager-qt
kdeframeworks/modemmanager-qt
kdeframeworks/bluez-qt
kdeframeworks/solid
kdeframeworks/karchive
kdeframeworks/kdbusaddons
kdeframeworks/kcoreaddons
kdeframeworks/kimageformats
kdeframeworks/kauth
kdeframeworks/kcrash
kdeframeworks/kjobwidgets
kdeframeworks/ki18n
kdeframeworks/kglobalaccel
kdeframeworks/kdoctools
kdeframeworks/kjs
kdeframeworks/kservice
kdeframeworks/kpackage
kdeframeworks/kpeople
kdeframeworks/kconfigwidgets
kdeframeworks/kiconthemes
kdeframeworks/knotifications
kdeframeworks/kcompletion
kdeframeworks/kdnssd
kdeframeworks/kwallet
kdeframeworks/kpty
kdeframeworks/kemoticons
kdeframeworks/kdesu
kdeframeworks/ktextwidgets
kdeframeworks/kxmlgui
kdeframeworks/kbookmarks
kdeframeworks/kio
kdeframeworks/kxmlrpcclient
kdeframeworks/kdesignerplugin
kdeframeworks/knewstuff
kdeframeworks/kparts
kdeframeworks/kdeclarative
kdeframeworks/kcmutils
kdeframeworks/kinit
kdeframeworks/kded
kdeframeworks/knotifyconfig
kdeframeworks/kunitconversion
kdeframeworks/kjsembed
kdeframeworks/kross
kdeframeworks/kmediaplayer
kdeframeworks/kdewebkit
kdeframeworks/ktexteditor
kdeframeworks/kapidox
kdeframeworks/frameworkintegration
kdeframeworks/kdelibs4support
kdeframeworks/khtml
kwayland-integration
kwallet-pam
kwalletmanager
libkomparediff2
grantlee
kdevplatform
kfilemetadata
baloo
baloo-widgets
kactivities
kactivities-stats
kpmcore
plasma-framework
krunner
milou
khelpcenter
kde-cli-tools
kio-extras
kde-baseapps
dolphin
libksysguard
ksysguard
kdecoration
kscreenlocker
oxygen
breeze
plasma-integration
kwin
libkscreen
plasma-workspace
plasma-desktop
kactivitymanagerd
khotkeys
kinfocenter
kmenuedit
systemsettings
kscreen
powerdevil
polkit-kde-agent-1
rekonq
kmix
konsole
kate
ark
konversation
kcalc
kompare
dragon
plasma-sdk
kdeplasma-addons
plasma-nm
plasma-pa
calligra
wind
hawaii-icon-themes
qtaccountsservice
libqtxdg
greenisland
libhawaii
fluid
hawaii-shell
hawaii-workspace
hawaii-system-preferences
xserver
xhost
glib
json-glib
harfbuzz
freetype2
fontconfig
pango
gdk-pixbuf
librsvg
atk
gtk
gnome-themes-standard
dconf
unico
vte
cogl
clutter
clutter-gtk
gobject-introspection
gjs
libusb
gsettings-desktop-schemas
evolution-data-server
mutter
gnome-shell
gnome-session
gdm
cairo-dock-core
cairo-dock-plugins
orbital
efl
enlightenment
terminology
etrophy
e_cho
elemines
econcentration
equate
ecrire
ephoto
SDL
SDL_image
SDL_ttf
glbinding
supertux
FreeGLUT
glfw
ffmpeg
mpv
gstreamer
gst-plugins-base
gst-plugins-bad
gst-plugins-good
gst-plugins-ugly
gst-plugins-gl
gst-libav
glmark
bemenu
wlc
orbment
sway
"
COMPILELIST+=$'\n'

if [[ ! -e /usr/bin/ubiquity ]]
then
  COMPILELIST+="calamares"
  COMPILELIST+=$'\n'
fi

echo "$COMPILELIST" | awk -F "#" '{print $1}' | while read BUILDNAME
do

  #compile_all is running to download the source
  if [[ "$argument" == download-only ]]
  then
    echo "Downloading/updating $BUILDNAME source"
    "/usr/bin/Compile/$BUILDNAME" download-only 2>&1 
  fi

  #compile_all is running to build the source
  if [[ "$argument" == build-only ]]
  then
    echo "building $BUILDNAME"
    "/usr/bin/Compile/$BUILDNAME" build-only 2>&1
  fi

  #Install the smaller version of the package
  if [[ "$argument" == installsmallpackage ]]
  then
    echo "Attempting to install smaller version of $BUILDNAME"
    "/usr/bin/Compile/$BUILDNAME" installsmallpackage 2>&1
  fi
  
  #compile_all is running to clean the source
  if [[ "$argument" == clean ]]
  then
    echo "Cleaning $BUILDNAME"
    "/usr/bin/Compile/$BUILDNAME" clean 2>&1
  fi
  
  #compile_all is running to download and build
  if [[ ! -n "$argument" ]]
  then
    "/usr/bin/Compile/$BUILDNAME"
  fi

done
